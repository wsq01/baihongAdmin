angular.module("app",["ui.router","ngAnimate","ngTable"]),angular.module("app").config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("users",{url:"/students",templateUrl:"view/students.html",controller:"studentsCtrl"}).state("class",{url:"/class",templateUrl:"view/class.html",controller:"classCtrl"}).state("teachers",{url:"/teachers",templateUrl:"view/teachers.html",controller:"teachersCtrl"}).state("managers",{url:"/managers",templateUrl:"view/managers.html",controller:"managersCtrl"}).state("course",{url:"/course",templateUrl:"view/course.html",controller:"courseCtrl"}).state("gartens",{url:"/gartens",templateUrl:"view/gartens.html",controller:"gartensCtrl"}).state("district",{url:"/district",templateUrl:"view/districts.html",controller:"districtCtrl"}).state("grade",{url:"/grade",templateUrl:"view/grade.html",controller:"gradeCtrl"}).state("reset",{url:"/reset",templateUrl:"view/reset.html",controller:"resetCtrl"}).state("category",{url:"/category",templateUrl:"view/category.html",controller:"categoryCtrl"}).state("categoryDetail",{url:"/categoryDetail",templateUrl:"view/categoryDetail.html",controller:"categoryDetailCtrl"}).state("parents",{url:"/parents",templateUrl:"view/parents.html",controller:"parentsCtrl"}).state("records",{url:"/records",templateUrl:"view/records.html",controller:"recordsCtrl"}).state("login",{url:"/login",templateUrl:"view/login.html",controller:"loginCtrl"}),t.otherwise("login")}]),angular.module("app").controller("categoryCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.building=e.categorys,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.building})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.getGrades=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.grades=e.grades})},t.getGrades(),t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"add",name:t.addItem.name,gid:t.addItem.gid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.change=function(a){t.buildingItem=a;var n=t.buildingItem.name,r=t.buildingItem.gid;t.change_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"edit",id:t.buildingItem.id,name:t.buildingItem.name,gid:t.buildingItem.gid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.buildingItem.name=n,t.buildingItem.gid=r,$("#changeModal").modal("hide")}},t.delete=function(a){t.buildingItem=a,t.delete_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"del",id:t.buildingItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.getFirstCateByGid=function(a,r){r.preventDefault(),e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"get",gid:a},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.building=e.categorys,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.building})})}}]),angular.module("app").controller("categoryDetailCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.dataLength=0,t.getData=function(){e({method:"post",url:"http://washer.mychaochao.cn/db/childedu/db/category.php",data:{sid:o,cmd:"get_detail",start:t.dataLength,num:999},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno&&(t.building=e.details,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.building}),100==e.details.length&&(t.dataLength+=100,t.getMore()))})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:scope.isShowFilter=!1},t.getGrades=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.grades=e.grades})},t.getMore=function(){e({method:"post",url:"http://washer.mychaochao.cn/db/childedu/db/category.php",data:{sid:o,cmd:"get_detail",start:t.dataLength},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){var a=t.building.concat(e.details);t.building=a})},t.getGrades(),t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"add_detail",name:t.addItem.name,cate:t.addItem.cate},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.change=function(a){t.buildingItem=a;var n=t.buildingItem.name,r=t.buildingItem.cate;t.change_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"edit_detail",id:t.buildingItem.id,name:t.buildingItem.name,cate:t.buildingItem.cate},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.buildingItem.name=n,t.buildingItem.cate=r,$("#changeModal").modal("hide")}},t.delete=function(a){t.buildingItem=a,t.delete_sure=function(){e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"del_detail",id:t.buildingItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.getFirstCateByGid=function(a,n){n.preventDefault(),e({method:"post",url:"../db/category.php",data:{sid:o,cmd:"get",gid:a},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.firstCategory=e.categorys,t.isShowFilter=!1})}}]),angular.module("app").controller("classCtrl",["$http","$scope","locals","NgTableParams","getClass",function(e,t,a,n,o){var r=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.classList=o.classList,t.getData=function(){t.classList.success(function(e){console.log(e),t.building=e.classes,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.building})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/class.php",data:{sid:r,cmd:"add",name:t.addItem.name,gid:t.addItem.gid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.change=function(a){t.buildingItem=a;var n=t.buildingItem.name,o=t.buildingItem.gid;t.change_sure=function(){e({method:"post",url:"../db/class.php",data:{sid:r,cmd:"edit",id:t.buildingItem.id,name:t.buildingItem.name,gid:t.buildingItem.gid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.buildingItem.name=n,t.buildingItem.gid=o,$("#changeModal").modal("hide")}},t.delete=function(a){t.buildingItem=a,t.delete_sure=function(){e({method:"post",url:"../db/class.php",data:{sid:r,cmd:"del",id:t.buildingItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}}}]),angular.module("app").controller("courseCtrl",["$http","$scope","locals","NgTableParams","$compile",function(e,t,a,n,o){var r=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/course.php",data:{sid:r,cmd:"get",name_audio:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.course=e.courses,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.course})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.uploadqAudios=[],$("#t_img").click(function(){$("#t_img").on("change",function(e){t.uploadFile=e.target.files[0]})}),t.add_sure=function(){console.log(t.uploadFile);var a=[],n=[],o=[];$("#questions input[type='text']").each(function(){a.push($(this).val())}),$("#questions input[type='file']").each(function(e,a){console.log(a.files[0]),t.uploadAudio(a.files[0]),o.push(a.files[0].name)}),t.uploadFile&&(n.push(t.uploadFile.name),console.log(n),t.uploadAudio(t.uploadFile)),console.log(o),e({method:"post",url:"../db/course.php",data:{sid:r,cmd:"add",name:t.addItem.name,target:t.addItem.target,problem:t.addItem.problem,gid:t.addItem.gid,questions:a,name_audio:"1",audio_names:n,question_audio:"",question_names:o},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#add").modal("hide")})}},t.uploadAudio=function(t){e({method:"post",url:"../db/oss.php",data:{sid:r,cmd:"get_auth"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){new OSS.Wrapper({region:e.region,accessKeyId:e.id,accessKeySecret:e.key,bucket:e.bucket}).multipartUpload("upload/"+t.name,t).then(function(e){console.log(e)}).catch(function(e){console.log(e)})})},t.change=function(a){a.question&&(a.questions=JSON.parse(a.question)),t.courseItem=a;var n=t.courseItem.name,o=t.courseItem.target,s=t.courseItem.problem,d=t.courseItem.gid;$("#t_subAudio").click(function(){$("#t_subAudio").on("change",function(e){t.changeFile=e.target.files[0]})}),t.change_sure=function(){var a=[],n=[],o=[];$("#addques input").each(function(){a.push($(this).val())}),t.changeFile&&(o.push(t.changeFile.name),console.log(o),t.uploadAudio(t.changeFile)),$("#changeQuestion input[type='file']").each(function(e,a){console.log(a.files[0]),a.files[0]&&(t.uploadAudio(a.files[0]),n.push(a.files[0].name))}),e({method:"post",url:"../db/course.php",data:{sid:r,cmd:"edit",id:t.courseItem.id,name:t.courseItem.name,problem:t.courseItem.problem,target:t.courseItem.target,gid:t.courseItem.gid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e)}),$("#changeModal").modal("hide")},t.change_cancel=function(){t.courseItem.name=n,t.courseItem.gid=d,t.courseItem.target=o,t.courseItem.problem=s,$("#changeModal").modal("hide")}},t.delete=function(a){t.courseItem=a,t.delete_sure=function(){e({method:"post",url:"../db/course.php",data:{sid:r,cmd:"del",id:t.courseItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.add_question=function(){var e=angular.element("<label class='col-sm-3 control-label'>问题:</label><div class='col-sm-8'><input type='text' class='form-control'></div><label class='col-sm-3 control-label'>问题语音:</label><div  class='col-sm-8'><input type='file' class='form-control'></div>"),a=o(e)(t);angular.element("#questions").append(a)},t.add_question2=function(){var e=angular.element("<label class='col-sm-3 control-label'>问题:</label><div class='col-sm-8'><input type='text' class='form-control'></div><label class='col-sm-3 control-label'>问题语音:</label><div  class='col-sm-8'><input type='file' class='form-control'></div>"),a=o(e)(t);angular.element("#addques").append(a)}}]),angular.module("app").controller("districtCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/district.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.district=e.districts,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.district})})},t.getData(),t.showFilters=function(){t.isShowFilter=0==t.isShowFilter},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/district.php",data:{sid:o,cmd:"add",name:t.addItem.name},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#add").modal("hide")})}},t.change=function(a){t.districtItem=a;var n=t.districtItem.name;t.change_sure=function(){e({method:"post",url:"../db/district.php",data:{sid:o,cmd:"edit",id:t.districtItem.id,name:t.districtItem.name},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e)}),$("#changeModal").modal("hide")},t.check_cancel=function(){t.districtItem.name=n,$("#changeModal").modal("hide")}},t.delete=function(a){t.districtItem=a,t.delete_sure=function(){e({method:"post",url:"../db/district.php",data:{sid:o,cmd:"del",id:t.districtItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}}}]),angular.module("app").controller("gartensCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/gartens.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.district=e.kidergartens,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.district})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/gartens.php",data:{sid:o,cmd:"add",name:t.addItem.name,city:t.addItem.city},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#add").modal("hide")})}},t.change=function(a){t.districtItem=a;var n=t.districtItem.name;t.change_sure=function(){e({method:"post",url:"../db/gartens.php",data:{sid:o,cmd:"edit",id:t.districtItem.id,name:t.districtItem.name,city:t.districtItem.city},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e)}),$("#changeModal").modal("hide")},t.check_cancel=function(){t.districtItem.name=n,$("#changeModal").modal("hide")}},t.delete=function(a){t.districtItem=a,t.delete_sure=function(){e({method:"post",url:"../db/gartens.php",data:{sid:o,cmd:"del",id:t.districtItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}}}]),angular.module("app").controller("gradeCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.school=e.grades,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.school})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"add",name:t.addItem.name,kid:t.addItem.kid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){t.getData(),$("#add").modal("hide")})}},t.change=function(a){t.schoolItem=a;var n=t.schoolItem.name,r=t.schoolItem.kid;t.change_sure=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"edit",id:t.schoolItem.id,name:t.schoolItem.name,kid:t.schoolItem.kid},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e)}),$("#changeModal").modal("hide")},t.change_cancel=function(){t.schoolItem.name=n,t.schoolItem.kid=r,$("#changeModal").modal("hide")}},t.delete=function(a){t.schoolItem=a,t.delete_sure=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"del",id:t.schoolItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}}}]),angular.module("app").controller("loginCtrl",["$http","$scope","$state","locals",function(e,t,a,n){t.enter=function(o){if(13==(window.event?o.keyCode:o.which)&&""!=$("#t_username").val()&&""!=$("#t_password").val()){var r=md5(md5($("#t_password").val())),s=$("#t_username").val();e({method:"post",url:"../../db/teacher.php",data:{cmd:"login",mobile:s,pwd:r,manager:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.permission(e.sid,e.uid),n.setObject("userInfo",e),a.go("users")):alert("账号或密码不正确，请重新输入！")})}o.stopPropagation()},t.submit=function(){var o=md5(md5($("#t_password").val())),r=$("#t_username").val();e({method:"post",url:"../db/teacher.php",data:{cmd:"login",mobile:r,pwd:o,manager:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.permission(e.sid,e.uid),n.setObject("userInfo",e),a.go("users")):alert("账号或密码不正确，请重新输入！")})},t.permission=function(t,a){e({method:"post",url:"../db/teacher.php",data:{sid:t,cmd:"get_list",manager:"1",id:a},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){if(console.log(e),"1"==e.errno){var t=e.managers[0].type;n.set("permission",t)}})}}]),angular.module("app").controller("managersCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){function o(){for(var e=0;e<t.user.length;e++)r(e,t.user[e].vendorid)}function r(a,n){e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"vendor_list",id:n},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){e.vendors&&(t.user[a].turnVendor=e.vendors[0].company)})}var s=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"get_list",manager:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.user=e.managers,o(),t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.user})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.change=function(a){t.userItem=a;var n=t.userItem.password,o=t.userItem.status,r=t.userItem.type;t.change_sure=function(){n==t.userItem.password?e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"edit_manager",id:t.userItem.id,pwd:t.userItem.password,status:t.userItem.status,type:t.userItem.type},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){t.getData(),$("#changeModal").modal("hide")}):e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"edit_manager",id:t.userItem.id,pwd:md5(md5(t.userItem.password)),status:t.userItem.status,type:t.userItem.type},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){t.getData(),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.userItem.status=o,t.userItem.type=r,$("#changeModal").modal("hide")}},t.delete=function(a){t.userItem=a,t.delete_sure=function(){e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"del",id:t.userItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(){t.getData(),$("#deleteModal").modal("hide")})}},t.addAdmin=function(){t.add_sure=function(){var a=md5(md5(t.addItem.pwd)),n=$("#t_status input[type='radio']:checked").val();e({method:"post",url:"../db/teacher.php",data:{sid:s,cmd:"add_manager",mobile:t.addItem.mobile,name:t.addItem.name,pwd:a,status:n,type:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#addAdmin").modal("hide").find("input").val(""),"1"==e.errno?t.getData():alert(e.errmsg)})}}}]),angular.module("app").controller("navCtrl",["$scope","locals","$state","$http","$interval",function(e,t,a,n,o){var r=t.getObject("userInfo");e.permission=t.get("permission","1"),e.userName=r.name,e.userId=r.uid;var s=r.sid,d=r.uid;e.exit=function(){t.setObject("userInfo",""),a.go("login")},e.changePwd=function(){e.change_sure=function(){n({method:"post",url:"../../db/user.php",data:{sid:s,cmd:"edit_pass",manager:"1",oldPass:md5(md5($("#t_oldPass").val())),newPass:md5(md5($("#t_newPass").val())),rePass:md5(md5($("#t_rePass").val()))},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"-6"==e.errno?alert(e.errmsg):"-7"==e.errno?alert(e.errmsg):"1"==e.errno&&alert("修改密码成功")}),$("#changePwd").modal("hide")},e.change_cancel=function(){$("#changePwd").modal("hide"),$("#t_newPwd").val("")}},e.changeInfo=function(){e.getCode=function(){var t=60;n({method:"post",url:"../../db/sms.php",data:{cmd:"send_captcha",mobile:e.myuser.mobile},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(a){console.log(a),t=60,e.time="60s";var n=o(function(){t<=0?(o.cancel(n),e.time=""):(t--,e.time=t+"s")},1e3)})},e.changeInfo_sure=function(){n({method:"post",url:"../../db/user.php",data:{sid:s,cmd:"edit_manager",manager:"1",mobile:e.myuser.mobile,captcha:e.myuser.captcha,id:d},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno&&alert("修改成功！")}),$("#changeInfo").modal("hide")},e.changeInfo_cancel=function(){$("#changeInfo").modal("hide")}}}]),angular.module("app").controller("parentsCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../user_db/user.php",data:{sid:o,cmd:"get_list",num:999},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e);for(var a=[],o=0;o<e.users.length;o++)e.users[o].mobile&&a.push(e.users[o]);t.user=a,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.user})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"add",name:t.addItem.name,gendor:t.addItem.gendor,class:t.addItem.class},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.delete=function(a){t.userItem=a,t.delete_sure=function(){e({method:"post",url:"../db/user.php",data:{sid:o,cmd:"del",id:t.userItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.change=function(a){t.userItem=a;var n=t.userItem.class,r=t.userItem.gendor,s=t.userItem.name;t.change_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"edit",id:t.userItem.id,class:t.userItem.class,name:t.userItem.name,gendor:t.userItem.gendor},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.userItem.gendor=r,t.userItem.name=s,t.userItem.class=n,$("#changeModal").modal("hide")}}}]),angular.module("app").controller("recordsCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../user_db/wxsu_pic.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.user=e.images,t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.user})})},t.getData(),t.showFilters=function(){t.isShowFilter=0==t.isShowFilter},t.change=function(a){t.userItem=a;var n=t.userItem.assess,r=t.userItem.gendor,s=t.userItem.name;t.change_sure=function(){e({method:"post",url:"../db/wxsu_pic.php",data:{sid:o,cmd:"wx_edit",id:t.userItem.id,student:t.userItem.student,user:t.userItem.user,descript:t.userItem.descript},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(a){console.log(a),e({method:"post",url:"../db/wxsu_pic.php",data:{sid:o,cmd:"edit",id:t.userItem.id,status:"2"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})})},t.change_cancel=function(){t.userItem.gendor=r,t.userItem.name=s,t.userItem.assess=n,$("#changeModal").modal("hide")}}}]),angular.module("app").controller("resetCtrl",["$http","$scope","$interval","$state",function(e,t,a,n){t.submit=function(){e({method:"post",url:"../db/teacher.php",data:{cmd:"reset",mobile:t.user.mobile,pwd:md5(md5(t.user.password)),captcha:t.user.captcha,manager:"1"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(alert("修改成功！"),n.go("login")):alert("输入错误！")})},t.getCode=function(){console.log(t.user);var n=60;e({method:"post",url:"../db/sms.php",data:{cmd:"send_captcha",mobile:t.user.mobile},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),n=60,t.time="60s";var o=a(function(){n<=0?(a.cancel(o),t.time=""):(n--,t.time=n+"s")},1e3)})}}]),angular.module("app").controller("studentsCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"get",num:999},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.user=e.students,t.getGradesData(),t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.user})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.getClassData=function(){e({method:"post",url:"../db/class.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.classData=e.classes;for(var a=0;a<t.user.length;a++)for(var n=0;n<t.classData.length;n++)if(t.user[a].class==t.classData[n].id){for(var o=0;o<t.grades.length;o++)t.classData[n].gid==t.grades[o].id&&(t.user[a].grade_name=t.grades[o].name);t.user[a].class_name=t.classData[n].name}})},t.getGradesData=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.grades=e.grades,t.getClassData()})},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"add",name:t.addItem.name,gendor:t.addItem.gendor,class:t.addItem.class},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.delete=function(a){t.userItem=a,t.delete_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"del",id:t.userItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.change=function(a){t.userItem=a;var n=t.userItem.class,r=t.userItem.gendor,s=t.userItem.name;t.change_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"edit",id:t.userItem.id,class:t.userItem.class,name:t.userItem.name,gendor:t.userItem.gendor},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.userItem.gendor=r,t.userItem.name=s,t.userItem.class=n,$("#changeModal").modal("hide")}}}]),angular.module("app").controller("teachersCtrl",["$http","$scope","locals","NgTableParams",function(e,t,a,n){var o=a.getObject("userInfo").sid;window.localStorage.getItem("uid");t.getData=function(){e({method:"post",url:"../db/teacher.php",data:{sid:o,cmd:"get_list",num:999},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.user=e.teachers,t.getdistrictsData(),t.getschoolsData(),t.getClassData(),t.getGradesData(),t.isShowFilter=!1,t.dataTable=new n({page:1,count:15},{counts:[15,20,30],dataset:t.user})})},t.getData(),t.showFilters=function(){0==t.isShowFilter?t.isShowFilter=!0:t.isShowFilter=!1},t.add=function(){t.add_sure=function(){e({method:"post",url:"../db/student.php",data:{sid:o,cmd:"add",name:t.addItem.name,gendor:t.addItem.gendor,class:t.addItem.class},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),"1"==e.errno?(t.getData(),$("#add").modal("hide")):alert("添加失败！")})}},t.delete=function(a){t.userItem=a,t.delete_sure=function(){e({method:"post",url:"../db/teacher.php",data:{sid:o,cmd:"del",id:t.userItem.id},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.getData(),$("#deleteModal").modal("hide")})}},t.getdistrictsData=function(){e({method:"post",url:"../db/district.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.districts=e.districts;for(var a=0;a<t.user.length;a++)for(var n=0;n<t.districts.length;n++)t.user[a].city==t.districts[n].id&&(t.user[a].city_name=t.districts[n].name)})},t.getschoolsData=function(){e({method:"post",url:"../db/gartens.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.schools=e.kidergartens;for(var a=0;a<t.user.length;a++)for(var n=0;n<t.schools.length;n++)t.user[a].city==t.schools[n].id&&(t.user[a].school_name=t.schools[n].name)})},t.getClassData=function(){e({method:"post",url:"../db/class.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.classes=e.classes;for(var a=0;a<t.user.length;a++)for(var n=0;n<t.classes.length;n++)t.user[a].city==t.classes[n].id&&(t.user[a].class_name=t.classes[n].name)})},t.getGradesData=function(){e({method:"post",url:"../db/grade.php",data:{sid:o,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),t.grades=e.grades;for(var a=0;a<t.user.length;a++)for(var n=0;n<t.grades.length;n++)t.user[a].city==t.grades[n].id&&(t.user[a].grade_name=t.grades[n].name)})},t.change=function(a){t.userItem=a;var n=t.userItem.class,r=t.userItem.gendor,s=t.userItem.name;t.change_sure=function(){e({method:"post",url:"../db/teacher.php",data:{sid:o,cmd:"edit",id:t.userItem.id,status:t.userItem.status},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){console.log(e),$("#changeModal").modal("hide")})},t.change_cancel=function(){t.userItem.gendor=r,t.userItem.name=s,t.userItem.class=n,$("#changeModal").modal("hide")}}}]),angular.module("app").filter("firstCategory",["$http","locals",function(e,t){var a=t.getObject("userInfo").sid;return function(t){var n="";return e({method:"post",url:"../db/category.php",data:{sid:a,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}}).success(function(e){n=e.errmsg}),n}}]),angular.module("app").filter("orderStatus",function(){return function(e){return"0"==e?"未付款":"1"==e?"已付款":"2"==e?"已完成":"错误"}}),angular.module("app").directive("appCategory",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/category.html"}}]),angular.module("app").directive("appCategoryDetail",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/categoryDetail.html"}}]),angular.module("app").directive("validator",[function(){return{restrict:"A",link:function(e,t,a){$(function(){t.bootstrapValidator({message:"This value is not valid",feedbackIcons:{valid:"glyphicon glyphicon-ok",invalid:"glyphicon glyphicon-remove",validating:"glyphicon glyphicon-refresh"},fields:{username:{message:"用户名无效",validators:{notEmpty:{message:"用户名不能为空"},stringLength:{min:3,max:16,message:"用户名长度应为3~16个字符"},regexp:{regexp:/^[a-zA-Z0-9_\.]+$/,message:"用户名只能由字母、数字、点和下划线组成"}}},password:{validators:{notEmpty:{message:"密码不能为空"},stringLength:{min:3,max:16,message:"密码长度应为3~16个字符"}}},reOption:{validators:{notEmpty:{message:"必填选项"}}},mobile:{validators:{notEmpty:{message:"手机号不能为空"},stringLength:{min:11,max:11,message:"手机号长度应为11个字符"}}},captcha:{validators:{notEmpty:{message:"验证码不能为空"},stringLength:{min:4,max:4,message:"验证码长度应为4个字符"}}}}})})}}}]),angular.module("app").directive("appClass",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/class.html"}}]),angular.module("app").directive("appCourse",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/course.html"}}]),angular.module("app").directive("appDistrict",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/districts.html"}}]),angular.module("app").directive("appGartens",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/gartens.html"}}]),angular.module("app").directive("appGrade",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/grade.html"}}]),angular.module("app").directive("appManagers",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/managers.html"}}]),angular.module("app").directive("appNav",[function(){return{restrict:"A",replace:!0,scope:{},templateUrl:"view/template/nav.html",controller:"navCtrl"}}]),angular.module("app").directive("appParents",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/parents.html"}}]),angular.module("app").directive("appRecords",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/records.html"}}]),angular.module("app").directive("appStudents",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/students.html"}}]),angular.module("app").directive("appTeachers",[function(){return{restrict:"A",replace:!0,templateUrl:"view/template/teachers.html"}}]),angular.module("app").factory("getClass",["$http","locals",function(e,t){var a=t.getObject("userInfo").sid;window.localStorage.getItem("uid");return{classList:e({method:"post",url:"../db/class.php",data:{sid:a,cmd:"get"},headers:{"Content-Type":"application/x-www-form-urlencoded"},transformRequest:function(e){return $.param(e)}})}}]),angular.module("app").factory("locals",["$window",function(e){return{set:function(t,a){e.localStorage[t]=a},get:function(t,a){return e.localStorage[t]||a},setObject:function(t,a){e.localStorage[t]=JSON.stringify(a)},getObject:function(t){return JSON.parse(e.localStorage[t]||"{}")}}}]);